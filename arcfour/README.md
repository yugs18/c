# RC4 (Arcfour) — C Implementation

A small, readable implementation of the RC4 (Arcfour) stream cipher written in C, designed for learning and experimentation.

## Overview

This project provides a lightweight, educational implementation of the RC4 stream cipher. Its purpose is to demonstrate how a classical stream cipher works internally — including state initialization, keystream generation, and symmetric encryption — using clear and minimal C code.

RC4 is historically significant and frequently studied in cryptography courses because of its simplicity and compact design. This implementation prioritizes **transparency and learning value** over performance or production-level security.

## Features

- Small, self-contained RC4 library with simple encryption API
- Internal RC4 state management with explicit algorithm steps
- Key-based initialization (KSA - Key Scheduling Algorithm)
- Byte-by-byte keystream generation (PRGA - Pseudo-Random Generation Algorithm)
- Symmetric encryption and decryption using XOR
- Optional keystream "whitewashing" (RC4-drop) to reduce statistical bias
- Example program demonstrating full encrypt → decrypt workflow

## Getting Started

### Building the Project

```bash
make              # Build the example program and shared library
make clean        # Remove build artifacts
```

### Running the Example

```bash
./example
```

This encrypts a sample message with a test key and decrypts it to verify the implementation.

## Files

| File | Purpose |
|------|---------|
| **arcfour.h** | Header file with RC4 state structure and public API |
| **arcfour.c** | Core RC4 implementation (KSA, PRGA, encryption) |
| **example.c** | Example program showing encryption/decryption workflow |
| **Makefile** | Build configuration for compiling the project |

## How It Works

### 1. RC4 State

RC4 maintains an internal state consisting of:
- Two indices (**i** and **j**)
- A 256-byte permutation array (**S**)
- A generated keystream byte (**k**)

The permutation array evolves continuously as data is processed.

### 2. Key Scheduling Algorithm (KSA)

During initialization:
- The permutation array is filled with values 0–255
- The user key is cycled through repeatedly
- Entries in the array are swapped based on key bytes
- Result: a key-dependent starting state

### 3. Pseudo-Random Generation Algorithm (PRGA)

For each output byte:
- Indices **i** and **j** are updated
- Elements in the permutation array are swapped
- A pseudo-random byte is selected from the array
- This byte becomes the keystream value

### 4. Encryption and Decryption

RC4 is a stream cipher using XOR:

$$\text{ciphertext} = \text{plaintext} \oplus \text{keystream}$$

Since XOR is reversible:

$$\text{plaintext} = \text{ciphertext} \oplus \text{keystream}$$

This means:
- **Encryption and decryption are identical operations**
- The cipher must be reinitialized with the same key to decrypt
- No key or IV management needed (suitable for educational purposes)

### 5. Keystream Whitewashing (RC4-drop)

Early RC4 keystream bytes contain statistical biases that could slightly weaken security. This implementation optionally discards an initial portion of generated bytes before use, reducing these biases for demonstration purposes.

## Design Philosophy

This project intentionally prioritizes:

- **Readable, step-by-step code** — Easy to follow algorithm flow
- **Explicit algorithm structure** — Clear separation of KSA and PRGA
- **Minimal abstraction** — Direct mapping to cryptographic concepts
- **Easy modification** — Suitable for experiments and learning

It is intended as a learning resource rather than a hardened cryptographic library.

## ⚠️ Security Notice

**RC4 is cryptographically broken** and is no longer recommended for real-world security use. Known weaknesses include:
- Biased keystream (especially early bytes)
- Distinguishing attacks in certain modes
- Key scheduling vulnerabilities under certain conditions

**This project exists solely for educational and historical exploration.**

If you need production-grade encryption, use modern algorithms like **AES** or **ChaCha20**.

## References

- [RC4 on Wikipedia](https://en.wikipedia.org/wiki/RC4)
- [Fluhrer, Mantin, and Shamir attack](https://en.wikipedia.org/wiki/Fluhrer,_Mantin_and_Shamir_attack)
